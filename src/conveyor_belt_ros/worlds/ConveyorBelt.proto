#VRML_SIM R2025a utf8

PROTO ConveyorBelt [
  field SFVec3f    translation     0 0 0
  field SFRotation rotation        0 1 0 0
  field SFString   name            "ConveyorBelt"
  field SFString   controller      "conveyor_controller"
  field SFColor    frameColor      0.3 0.3 0.3
  field SFColor    beltColor       0.15 0.15 0.15
]
{
  Robot {
    translation IS translation
    rotation IS rotation
    name IS name
    controller IS controller
    children [
      DEF BELT_BASE Group {
        children [
          # Main frame structure
          Transform {
            children [
              # Base frame
              Transform {
                translation 0 0 0.8
                children [
                  Shape {
                    appearance PBRAppearance {
                      baseColor IS frameColor
                      metalness 0.9
                      roughness 0.2
                    }
                    geometry Box {
                      size 2.0 0.8 0.05
                    }
                  }
                ]
              }
              
              # Left side frame
              Transform {
                translation 0 0.4 0.4
                children [
                  Shape {
                    appearance PBRAppearance {
                      baseColor IS frameColor
                      metalness 0.9
                      roughness 0.2
                    }
                    geometry Box {
                      size 2.0 0.05 0.8
                    }
                  }
                ]
              }
              
              # Right side frame
              Transform {
                translation 0 -0.4 0.4
                children [
                  Shape {
                    appearance PBRAppearance {
                      baseColor IS frameColor
                      metalness 0.9
                      roughness 0.2
                    }
                    geometry Box {
                      size 2.0 0.05 0.8
                    }
                  }
                ]
              }
              
              # Front vertical support
              Transform {
                translation 1.0 0 0.4
                children [
                  Shape {
                    appearance PBRAppearance {
                      baseColor IS frameColor
                      metalness 0.9
                      roughness 0.2
                    }
                    geometry Box {
                      size 0.05 0.8 0.8
                    }
                  }
                ]
              }
              
              # Back vertical support
              Transform {
                translation -1.0 0 0.4
                children [
                  Shape {
                    appearance PBRAppearance {
                      baseColor IS frameColor
                      metalness 0.9
                      roughness 0.2
                    }
                    geometry Box {
                      size 0.05 0.8 0.8
                    }
                  }
                ]
              }
              
              # Supporting legs (4 corners)
              Transform {
                translation 1.0 0.4 0
                children [
                  Shape {
                    appearance PBRAppearance {
                      baseColor IS frameColor
                      metalness 0.9
                      roughness 0.2
                    }
                    geometry Cylinder {
                      height 0.8
                      radius 0.04
                      subdivision 16
                    }
                  }
                ]
              }
              Transform {
                translation 1.0 -0.4 0
                children [
                  Shape {
                    appearance PBRAppearance {
                      baseColor IS frameColor
                      metalness 0.9
                      roughness 0.2
                    }
                    geometry Cylinder {
                      height 0.8
                      radius 0.04
                      subdivision 16
                    }
                  }
                ]
              }
              Transform {
                translation -1.0 0.4 0
                children [
                  Shape {
                    appearance PBRAppearance {
                      baseColor IS frameColor
                      metalness 0.9
                      roughness 0.2
                    }
                    geometry Cylinder {
                      height 0.8
                      radius 0.04
                      subdivision 16
                    }
                  }
                ]
              }
              Transform {
                translation -1.0 -0.4 0
                children [
                  Shape {
                    appearance PBRAppearance {
                      baseColor IS frameColor
                      metalness 0.9
                      roughness 0.2
                    }
                    geometry Cylinder {
                      height 0.8
                      radius 0.04
                      subdivision 16
                    }
                  }
                ]
              }
              
              # Front roller (with motor)
              HingeJoint {
                jointParameters HingeJointParameters {
                  axis 0 1 0
                  anchor 1.0 0 0.8
                }
                device [
                  RotationalMotor {
                    name "front_roller"
                  }
                ]
                endPoint Solid {
                  translation 1.0 0 0.8
                  rotation 1 0 0 1.5708
                  children [
                    Shape {
                      appearance PBRAppearance {
                        baseColor 0.2 0.2 0.2
                        metalness 0.8
                        roughness 0.3
                      }
                      geometry Cylinder {
                        height 0.8
                        radius 0.08
                        subdivision 20
                      }
                    }
                  ]
                  name "front_roller"
                  boundingObject Cylinder {
                    height 0.8
                    radius 0.08
                  }
                  physics Physics {
                    density -1
                    mass 0.5
                  }
                }
              }
              
              # Back roller (with motor)
              HingeJoint {
                jointParameters HingeJointParameters {
                  axis 0 1 0
                  anchor -1.0 0 0.8
                }
                device [
                  RotationalMotor {
                    name "back_roller"
                  }
                ]
                endPoint Solid {
                  translation -1.0 0 0.8
                  rotation 1 0 0 1.5708
                  children [
                    Shape {
                      appearance PBRAppearance {
                        baseColor 0.2 0.2 0.2
                        metalness 0.8
                        roughness 0.3
                      }
                      geometry Cylinder {
                        height 0.8
                        radius 0.08
                        subdivision 20
                      }
                    }
                  ]
                  name "back_roller"
                  boundingObject Cylinder {
                    height 0.8
                    radius 0.08
                  }
                  physics Physics {
                    density -1
                    mass 0.5
                  }
                }
              }
              
              # Conveyor Belt with Texture and Visualization Markers
              Transform {
                translation 0 0 0.82
                children [
                  # Main belt material
                  Shape {
                    appearance PBRAppearance {
                      baseColor IS beltColor
                      metalness 0.1
                      roughness 0.9
                      textureTransform TextureTransform {
                        scale 4 1
                      }
                    }
                    geometry Box {
                      size 2.0 0.8 0.02
                    }
                  }
                ]
              }
              
              # MARKER 1
              DEF MARKER1 Transform {
                translation 0.75 0 0.83
                children [
                  Shape {
                    appearance PBRAppearance {
                      baseColor 1 1 1
                      emissiveColor 1 1 1
                      metalness 0
                      roughness 0.2
                    }
                    geometry Cylinder {
                      height 0.001
                      radius 0.05
                      subdivision 16
                    }
                  }
                ]
              }
              
              # MARKER 2
              DEF MARKER2 Transform {
                translation 0.25 0 0.83
                children [
                  Shape {
                    appearance PBRAppearance {
                      baseColor 1 1 1
                      emissiveColor 1 1 1
                      metalness 0
                      roughness 0.2
                    }
                    geometry Cylinder {
                      height 0.001
                      radius 0.05
                      subdivision 16
                    }
                  }
                ]
              }
              
              # MARKER 3
              DEF MARKER3 Transform {
                translation -0.25 0 0.83
                children [
                  Shape {
                    appearance PBRAppearance {
                      baseColor 1 1 1
                      emissiveColor 1 1 1
                      metalness 0
                      roughness 0.2
                    }
                    geometry Cylinder {
                      height 0.001
                      radius 0.05
                      subdivision 16
                    }
                  }
                ]
              }
              
              # MARKER 4
              DEF MARKER4 Transform {
                translation -0.75 0 0.83
                children [
                  Shape {
                    appearance PBRAppearance {
                      baseColor 1 1 1
                      emissiveColor 1 1 1
                      metalness 0
                      roughness 0.2
                    }
                    geometry Cylinder {
                      height 0.001
                      radius 0.05
                      subdivision 16
                    }
                  }
                ]
              }

              # Direction Arrow (shows movement direction)
              Transform {
                translation 0 0 0.83
                rotation 0 0 1 1.5708
                children [
                  Shape {
                    appearance PBRAppearance {
                      baseColor 1 0 0
                      emissiveColor 1 0 0
                      metalness 0
                      roughness 0.2
                    }
                    geometry IndexedFaceSet {
                      coord Coordinate {
                        point [
                          0 0.2 0,
                          0.15 0 0,
                          0 -0.2 0,
                          -0.15 0 0
                        ]
                      }
                      coordIndex [
                        0, 1, 2, -1,
                        0, 2, 3, -1
                      ]
                    }
                  }
                ]
              }
              
              # Control panel
              Transform {
                translation 1.0 0.55 0.7
                rotation 0 0 1 -0.2
                children [
                  Shape {
                    appearance PBRAppearance {
                      baseColor 0.15 0.15 0.15
                      metalness 0.7
                      roughness 0.3
                    }
                    geometry Box {
                      size 0.25 0.3 0.1
                    }
                  }
                  # Status LED
                  Transform {
                    translation 0 0.07 0.06
                    children [
                      Shape {
                        appearance PBRAppearance {
                          baseColor 0 0.8 0
                          emissiveColor 0 0.8 0
                          metalness 0
                          roughness 0.2
                        }
                        geometry Cylinder {
                          height 0.01
                          radius 0.02
                          subdivision 12
                        }
                      }
                    ]
                  }
                  # Direction LED
                  Transform {
                    translation 0 0 0.06
                    children [
                      Shape {
                        appearance PBRAppearance {
                          baseColor 0 0 0.8
                          emissiveColor 0 0 0.8
                          metalness 0
                          roughness 0.2
                        }
                        geometry Cylinder {
                          height 0.01
                          radius 0.02
                          subdivision 12
                        }
                      }
                    ]
                  }
                  # Buttons
                  Transform {
                    translation 0 -0.07 0.06
                    children [
                      Shape {
                        appearance PBRAppearance {
                          baseColor 0.7 0 0
                          metalness 0.2
                          roughness 0.3
                        }
                        geometry Cylinder {
                          height 0.02
                          radius 0.02
                          subdivision 12
                        }
                      }
                    ]
                  }
                ]
              }
            ]
          }
        ]
      }
    ]
    boundingObject Box {
      size 2.0 0.8 0.8
    }
    physics Physics {
      density -1
      mass 100
    }
  }
} 